<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<meta name="theme-color" content="#071028"/>
<title>Selamat Ulang Tahun, Resti! üéâ</title>
<style>
:root{
  --bg:#071028;
  --card:#081833;
  --muted:#9fb0d6;
  --accent1:#ff7a88;
  --accent2:#6ec1ff;
  --bubble:#e6f7ff;
  --radius:14px;
  --font-sans: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  --tap:48px;
}
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{
  font-family:var(--font-sans);
  background:
    radial-gradient(600px 300px at 10% 10%, rgba(110,193,255,0.06), transparent 8%),
    radial-gradient(500px 240px at 90% 90%, rgba(255,122,136,0.04), transparent 6%),
    var(--bg);
  color:#eaf4ff;
  display:flex;align-items:flex-start;justify-content:center;padding:14px 12px;
  -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;
}

/* container */
.wrap{width:100%;max-width:720px;display:flex;flex-direction:column;gap:14px}

/* card */
.card{background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:14px;padding:14px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 10px 30px rgba(2,6,23,0.6);backdrop-filter:blur(6px) saturate(120%);}

/* header */
.header{display:flex;gap:12px;align-items:center}
.logo{width:54px;height:54px;border-radius:12px;background:linear-gradient(135deg,var(--accent1),var(--accent2));display:flex;align-items:center;justify-content:center;font-weight:800;font-size:20px;color:white;box-shadow:0 8px 18px rgba(124,92,255,0.12)}
.hmeta h1{font-size:17px;margin-bottom:2px}
.hmeta p{font-size:13px;color:var(--muted)}

/* hero */
.hero{margin-top:12px;border-radius:12px;overflow:hidden;min-height:260px;position:relative;display:flex;flex-direction:column;gap:12px;padding:14px;background: radial-gradient(400px 160px at 8% 10%, rgba(255,122,136,0.06), transparent 8%), radial-gradient(320px 120px at 92% 90%, rgba(110,193,255,0.04), transparent 8%), linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.06));}

/* uploaded photo preview */
.photoWrap{width:100%;height:160px;border-radius:12px;overflow:hidden;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.06));display:flex;align-items:center;justify-content:center;position:relative}
.photoWrap img{width:100%;height:100%;object-fit:cover;display:block}
.photoPlaceholder{color:var(--muted);font-size:14px;text-align:center;padding:12px}

/* praise badge */
.praise{
  position:absolute;left:12px;bottom:12px;padding:8px 12px;border-radius:12px;background:linear-gradient(90deg,var(--accent1),var(--accent2));color:white;font-weight:700;box-shadow:0 10px 30px rgba(124,92,255,0.12);display:flex;align-items:center;gap:8px;
  transform-origin:left bottom;
}

/* msgs and character */
.msgs{display:flex;flex-direction:column;gap:10px}
.bubble{max-width:100%;padding:12px 14px;border-radius:18px;background:var(--bubble);color:#072033;font-weight:700;box-shadow:0 10px 26px rgba(6,12,28,0.24);position:relative;cursor:pointer;transition:transform .12s ease,box-shadow .12s ease;font-size:15px}
.bubble.me{align-self:flex-end;background:linear-gradient(90deg,var(--accent2),#b9f0ff);color:#022133}
.bubble.you{align-self:flex-start;background:linear-gradient(90deg,var(--accent1),#ffdfe2);color:#120017}
.meta{font-size:12px;color:var(--muted);margin-top:6px}

/* character */
.character{display:flex;flex-direction:row;gap:12px;align-items:center;justify-content:space-between}
.cartoon{flex:0 0 110px;height:110px;background:linear-gradient(180deg,#fff,#f8fbff);border-radius:18px;padding:10px;display:flex;flex-direction:column;align-items:center;justify-content:center;box-shadow:0 16px 36px rgba(6,12,28,0.28)}
.eyes{display:flex;gap:12px;align-items:center}
.eye{width:24px;height:24px;border-radius:50%;background:#071028;box-shadow:inset 0 -6px 8px rgba(255,255,255,0.06)}
.mouth{width:64px;height:16px;border-radius:16px;background:#ffd6de;margin-top:8px;position:relative}
.mouth::after{content:'';position:absolute;left:50%;top:50%;transform:translate(-50%,-30%);width:44px;height:8px;border-radius:8px;background:#fff}

/* confetti overlay */
.confetti{position:absolute;inset:8px;pointer-events:none;z-index:8}
.confetti i{position:absolute;width:8px;height:12px;border-radius:2px;opacity:0;transform:translateY(-10px) rotate(10deg);animation:drop 1800ms linear infinite;mix-blend-mode:screen}
@keyframes drop{0%{opacity:0;transform:translateY(-20px) rotate(0deg)}10%{opacity:1}100%{opacity:1;transform:translateY(260px) rotate(360deg)}}

/* actions */
.actions{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap}
.btn{min-height:var(--tap);padding:12px 14px;border-radius:12px;background:transparent;color:#eaf4ff;border:1px solid rgba(255,255,255,0.04);cursor:pointer;font-size:15px}
.btn.primary{background:linear-gradient(90deg,var(--accent1),var(--accent2));border:none;color:white;font-weight:700}

/* file input visually hidden but accessible */
.fileInput{display:none}

/* responsive tweaks */
@media (max-width:420px){
  .logo{width:48px;height:48px}
  .hero{padding:12px;min-height:220px}
  .photoWrap{height:140px}
  .cartoon{flex-basis:100px;height:100px}
}

/* reduced motion */
@media (prefers-reduced-motion: reduce){
  .confetti i{animation:none;opacity:1}
}
</style>
</head>
<body>
<div class="wrap">

  <main class="card" role="main" aria-labelledby="title">
    <div class="header">
      <div class="logo" aria-hidden="true">üéÇ</div>
      <div class="hmeta">
        <h1 id="title">Selamat Ulang Tahun ke-25, Resti!</h1>
        <p>Dari: Azi ‚Äî Semoga hari ini penuh tawa & cinta üíñ</p>
      </div>
    </div>

    <div class="hero" id="hero">
      <div class="confetti" id="confetti" aria-hidden="true"></div>

      <div class="photoWrap" id="photoWrap" aria-live="polite">
        <div class="photoPlaceholder" id="photoPlaceholder">Belum ada foto. Ketuk "Unggah Foto" untuk menambahkan.</div>
        <!-- preview img inserted here -->
        <!-- praise badge -->
        <!-- inserted dynamically -->
      </div>

      <div class="msgs" role="list" aria-label="Pesan">
        <div class="bubble you" id="b1" tabindex="0" role="button" aria-pressed="false">Hai Resti! üéà <div class="meta">Azi ‚Ä¢ 09:00</div></div>
        <div class="bubble me" id="b2" tabindex="0" role="button" aria-pressed="false">Selamat ulang tahun ke-25! Semoga semua mimpimu tercapai. <div class="meta">Azi ‚Ä¢ 09:01</div></div>
        <div class="bubble you" id="b3" tabindex="0" role="button" aria-pressed="false">Kalau mau ada kejutan, bilang ya! üòâ <div class="meta">Azi ‚Ä¢ 09:02</div></div>
        <div class="bubble me" id="b4" tabindex="0" role="button" aria-pressed="false">Resti, terima kasih sudah hadir dalam hidupku. Love you ‚ù§Ô∏è <div class="meta">Azi ‚Ä¢ 09:03</div></div>
      </div>

      <div class="character" role="region" aria-label="Karakter interaktif">
        <div class="cartoon" id="cartoon">
          <div class="eyes"><div class="eye" id="eyeL"></div><div class="eye" id="eyeR"></div></div>
          <div class="mouth" id="mouth"></div>
          <div style="margin-top:8px;font-weight:800;color:#071028">Koala </div>
        </div>

        <div style="display:flex;flex-direction:column;gap:8px;width:46%;">
          <input id="fileInput" class="fileInput" type="file" accept="image/*" />
          <button class="btn" id="btnUpload" aria-label="Unggah Foto">üì∏ Unggah Foto</button>
          <button class="btn" id="btnPraise" aria-label="Puji Foto">‚ú® Puji Foto</button>
        </div>
      </div>
    </div>

    <div class="actions">
      <button class="btn primary" id="btnPlay">‚ñ∂Ô∏è Putar Ucapan</button>
      <button class="btn" id="btnShare">üîó Bagikan</button>
      <button class="btn" id="btnDownload">‚¨áÔ∏è Unduh Gambar</button>
    </div>
  </main>

</div>

<script>
/* Enhanced mobile interactions:
 - Upload foto, preview, and allow praising the photo with random compliment
 - Compliments displayed as badge over photo and spoken via TTS
 - Confetti & heart effects remain
*/

const fileInput = document.getElementById('fileInput');
const btnUpload = document.getElementById('btnUpload');
const btnPraise = document.getElementById('btnPraise');
const photoWrap = document.getElementById('photoWrap');
const photoPlaceholder = document.getElementById('photoPlaceholder');
const confettiEl = document.getElementById('confetti');
const hero = document.getElementById('hero');
const btnPlay = document.getElementById('btnPlay');
const btnShare = document.getElementById('btnShare');
const btnDownload = document.getElementById('btnDownload');
const eyeL = document.getElementById('eyeL'), eyeR = document.getElementById('eyeR'), mouth = document.getElementById('mouth');

let currentImageURL = null;

// compliments list (feel free to customize)
const compliments = [
  "Foto yang keren banget, Resti ‚Äî vibesnya aesthetic!",
  "Wah, bak model! Potret ini flawless.",
  "Foto ini sukses bikin hari cerah ‚Äî kamu glowing!",
  "Gila, komposisinya apik dan ekspresif. Keren!",
  "Senyummu di foto ini juara ‚Äî hangat & memikat!",
  "Warna dan mood-nya pas banget. Top banget!",
  "Ekspresimu natural dan memesona. Bikin terkesima!",
  "Foto ini punya aura profesional ‚Äî luar biasa!",
  "Keren! Ini layak jadi cover feed.",
  "Sangat instagenic ‚Äî siap dapat banyak like!"
];

// utilities
function rand(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }

// confetti
function spawnConfetti(count=18){
  confettiEl.innerHTML='';
  const colors = ['#ff7a88','#ffd36b','#6ec1ff','#a2ffb8','#ffb3ff'];
  for(let i=0;i<count;i++){
    const el = document.createElement('i');
    el.style.left = (6 + Math.random()*88) + '%';
    el.style.top = (Math.random()*8) + '%';
    el.style.background = colors[Math.floor(Math.random()*colors.length)];
    el.style.transform = `translateY(-30px) rotate(${rand(0,360)}deg)`;
    el.style.animationDelay = (Math.random()*700) + 'ms';
    el.style.width = (6 + Math.random()*8)+'px';
    el.style.height = (8 + Math.random()*10)+'px';
    confettiEl.appendChild(el);
  }
  setTimeout(()=> confettiEl.innerHTML = '', 3200);
}

// heart pop
function heartPop(){
  const el = document.createElement('div');
  el.style.position='absolute'; el.style.left='50%'; el.style.top='8%';
  el.style.transform='translateX(-50%)'; el.style.pointerEvents='none';
  el.innerHTML = `<svg width="56" height="56" viewBox="0 0 24 24"><path fill="url(#gPop)" d="M12 21s-7.072-4.904-9.25-8.004C-0.25 8.745 3.2 4.5 6.5 6.25 8.1 7.2 9 9 12 11c3-2 3.9-3.8 5.5-4.75 3.3-1.75 6.75 2.495 3.75 6.746C19.073 16.096 12 21 12 21z"/></svg>`;
  el.querySelector('svg').innerHTML += `<defs><linearGradient id="gPop" x1="0" x2="1"><stop offset="0" stop-color="#ff7a88"/><stop offset="1" stop-color="#6ec1ff"/></linearGradient></defs>`;
  hero.appendChild(el);
  el.animate([
    {transform:'translateX(-50%) translateY(0) scale(.9)', opacity:0},
    {transform:'translateX(-50%) translateY(-28px) scale(1.08)', opacity:1},
    {transform:'translateX(-50%) translateY(-64px) scale(.9)', opacity:0}
  ], {duration:1300, easing:'cubic-bezier(.2,.9,.2,1)'});
  setTimeout(()=> el.remove(), 1400);
}

// expressions
function setExpression(expr){
  eyeL.style.transition = 'all 160ms ease'; eyeR.style.transition = 'all 160ms ease'; mouth.style.transition = 'all 180ms ease';
  if(expr==='happy'){ eyeL.style.height='24px'; eyeR.style.height='24px'; mouth.style.width='80px'; }
  else if(expr==='wink'){ eyeL.style.height='6px'; eyeR.style.height='24px'; mouth.style.width='72px'; }
  else if(expr==='surprised'){ eyeL.style.height='30px'; eyeR.style.height='30px'; mouth.style.width='40px'; }
  else if(expr==='love'){ eyeL.style.background='radial-gradient(circle at 50% 40%, #ff7a88, #6ec1ff)'; eyeR.style.background='radial-gradient(circle at 50% 40%, #ff7a88, #6ec1ff)'; mouth.style.width='86px'; }
  else { eyeL.style.background='#071028'; eyeR.style.background='#071028'; eyeL.style.height='24px'; eyeR.style.height='24px'; mouth.style.width='64px'; }
}

// TTS
function speak(text){
  if('speechSynthesis' in window){
    const u = new SpeechSynthesisUtterance(text);
    u.lang = 'id-ID'; u.rate = 1; u.pitch = 1;
    speechSynthesis.cancel(); speechSynthesis.speak(u);
  } else { console.log('TTS:', text); }
}

// handle upload
btnUpload.addEventListener('click', ()=> fileInput.click());
fileInput.addEventListener('change', (e)=>{
  const f = e.target.files && e.target.files[0];
  if(!f) return;
  if(currentImageURL) URL.revokeObjectURL(currentImageURL);
  currentImageURL = URL.createObjectURL(f);
  showPhotoPreview(currentImageURL);
  // small expression
  setExpression('happy');
  setTimeout(()=> setExpression('neutral'), 1200);
});

function showPhotoPreview(url){
  photoWrap.innerHTML = ''; // clear
  const img = document.createElement('img');
  img.src = url;
  img.alt = 'Foto yang diunggah';
  img.onload = ()=> {
    // remove placeholder
  };
  photoWrap.appendChild(img);
  // add praise badge container (dynamic)
  const badge = document.createElement('div');
  badge.className = 'praise';
  badge.id = 'praiseBadge';
  badge.style.display='none';
  photoWrap.appendChild(badge);
}

// praise action
btnPraise.addEventListener('click', ()=>{
  if(!currentImageURL){
    // if no photo, small nudge
    speak('Unggah fotomu dulu, Resti. Aku tunggu!');
    setExpression('surprised');
    setTimeout(()=> setExpression('neutral'), 1000);
    return;
  }
  const compliment = compliments[rand(0,compliments.length-1)];
  showPraise(compliment);
});

function showPraise(text){
  // show badge
  const badge = document.getElementById('praiseBadge');
  if(badge){
    badge.textContent = text;
    badge.style.display = 'flex';
    badge.style.opacity = '0';
    badge.animate([{transform:'translateY(10px) scale(.96)', opacity:0},{transform:'translateY(0) scale(1)', opacity:1}], {duration:380, easing:'cubic-bezier(.2,.9,.2,1)'});
    // confetti + heart + tts
    spawnConfetti(18);
    heartPop();
    speak(text);
    setExpression('love');
    setTimeout(()=> setExpression('neutral'), 1800);
    // auto-hide after few seconds
    setTimeout(()=> {
      badge.animate([{opacity:1, transform:'translateY(0)'},{opacity:0, transform:'translateY(6px)'}], {duration:360}).onfinish = ()=> badge.style.display='none';
    }, 4200);
  }
}

/* other interactions (share, play, download) */
document.getElementById('btnShare').addEventListener('click', async ()=>{
  const title = document.title; const text = 'Ucapan ulang tahun untuk Resti dari Azi üéâ';
  try{ if(navigator.share) await navigator.share({title, text, url: location.href}); else { await navigator.clipboard.writeText(location.href); alert('Link disalin.'); } }catch(e){ alert('Gagal berbagi: '+e.message); }
});

document.getElementById('btnPlay').addEventListener('click', ()=> speak('Selamat ulang tahun Resti, dari Azi. Semoga hari ini dan seterusnya penuh cinta dan kebahagiaan.'));

document.getElementById('btnDownload').addEventListener('click', async ()=>{
  try{
    const el = document.getElementById('hero');
    const rect = el.getBoundingClientRect();
    const width = rect.width, height = rect.height;
    const clone = el.cloneNode(true);
    const serializer = new XMLSerializer();
    const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='${width}' height='${height}'><foreignObject width='100%' height='100%'>${serializer.serializeToString(clone)}</foreignObject></svg>`;
    const blob = new Blob([svg], {type:'image/svg+xml;charset=utf-8'});
    const url = URL.createObjectURL(blob);
    const img = new Image();
    img.onload = ()=> {
      const c = document.createElement('canvas'); c.width = width*2; c.height = height*2;
      const ctx = c.getContext('2d'); ctx.scale(2,2); ctx.drawImage(img,0,0);
      URL.revokeObjectURL(url);
      c.toBlob(b=>{
        const a = document.createElement('a'); a.href = URL.createObjectURL(b); a.download = 'ucapan-resti-25.png'; a.click(); URL.revokeObjectURL(a.href);
      }, 'image/png');
    };
    img.src = url;
  }catch(err){ alert('Tidak dapat mengunduh: ' + err.message); }
});

/* initial small confetti */
setTimeout(()=> spawnConfetti(12), 700);

/* bubble interactions retained (simple responses) */
document.querySelectorAll('.bubble').forEach(b=>{
  b.addEventListener('click', ()=> {
    b.classList.add('pop'); setTimeout(()=> b.classList.remove('pop'), 260);
    if(b.id==='b1'){ speak('Hai Resti! Semoga harimu menyenangkan!'); setExpression('happy'); }
    if(b.id==='b2'){ speak('Selamat ulang tahun Resti! Semoga semua mimpimu tercapai.'); setExpression('love'); }
    if(b.id==='b3'){ speak('Kejutan akan datang, sabar ya!'); spawnConfetti(14); setExpression('wink'); }
    if(b.id==='b4'){ speak('Aku sayang kamu Resti.'); heartPop(); setExpression('love'); }
    setTimeout(()=> setExpression('neutral'), 1400);
  });
});

/* accessibility: keyboard shortcuts for desktop testers */
document.addEventListener('keydown', (e)=>{
  if(e.key.toLowerCase()==='c') spawnConfetti(20);
  if(e.key.toLowerCase()==='h') heartPop();
});
</script>
</body>
</html>